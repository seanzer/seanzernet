<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>Seanzer.net - IT'S A PaRTY!!</title>
    <style>
        html {
            touch-action: none;
        }
    </style>
</head>

<body>
    <script>
        (function () {
            "use strict";

            var canvas = document.createElement("canvas");
            document.body.appendChild(canvas);
            canvas.style.backgroundColor = "Lightgrey";
            canvas.height = window.innerHeight - 60;
            canvas.width = window.innerWidth - 60;
            window.addEventListener("resize", function () {
                canvas.height = window.innerHeight - 60;
                canvas.width = window.innerWidth - 60;
            });

            //get canvas context
            var context = canvas.getContext('2d');
            context.lineWidth = 2;
            function drawText(font, text, x, y) {
                context.font = font;
                context.fillText(text, x, y);
            }
            function drawMyName() {
                var font = "20px Georgia"
                    , text = "Welcome to Seanzer.Net... by SeanLee"
                    , x = 10
                    , y = 100;
                drawText(font, text, x, y);
            }
            function drawBallCount() {
                var font = "12px Georgia"
                    , text = "Total balls: " + balls.length
                    , x = 16
                    , y = 120;
                drawText(font, text, x, y);
            }
            function drawLine(from, to, strokeStyle) {
                context.beginPath();
                context.moveTo(from.x, from.y);
                context.lineTo(to.x, to.y);
                context.strokeStyle = strokeStyle || "rgb(0,0,0)";
                context.stroke();
            }
            function drawBall(x, y, radius, color) {
                context.beginPath();
                context.arc(x, y, radius, 0, 2 * Math.PI, false);
                context.fillStyle = color || "rgb(0,0,0)";
                context.fill();
            }

            var balls = [];
            balls.redCount = 0;
            balls.greenCount = 0;
            balls.blueCount = 0;
            balls.push({
                x: 20 + 20 * Math.random(),
                y: 23,
                radius: 20,
                color: "red",
                vx: .08,
                vy: .1
            });
            balls.push({
                x: 100 * Math.random() + 100,
                y: 23,
                radius: 20,
                color: "green",
                vx: 0,
                vy: .5
            });

            function render() {
                update();

                //clear
                context.clearRect(0, 0, canvas.width, canvas.height);

                //draw
                (function draw() {
                    for (var i = 0; i < balls.length; i++) {
                        var ball = balls[i];
                        drawBall(ball.x, ball.y, ball.radius, ball.color);
                    }
                    drawMyName();
                    drawBallCount();
                    (function drawColorCounts() {
                        var font = "20px Georgia"
                            , text = "Red: " + balls.redCount
                            , x = 10
                            , y = 140;
                        context.strokeStyle = "rgb(255,0,0)";
                        drawText(font, text, x, y);

                        text = "Green: " + balls.greenCount
                        y = 160;
                        context.strokeStyle = "rgb(0,255,0)";
                        drawText(font, text, x, y);

                        text = "Blue: " + balls.blueCount
                        y = 180;
                        context.strokeStyle = "rgb(0,0,255)";
                        drawText(font, text, x, y);
                    })();
                })();

                requestAnimationFrame(render);
            }
            var last = performance.now();
            render();

            var maxBalls = Number.MAX_VALUE;
            var canvasHeight = 0;
            var canvasWidth = 0;
            function update() {
                canvasHeight = canvas.height;
                canvasWidth = canvas.width;
                var elasticityFloor = .6;
                var elasticityWall = .2;

                //update
                var now = performance.now();
                var dist = now - last;
                if (dist > 50) {
                    maxBalls = Math.max(balls.length - 2, 2);
                    dist = 50;
                } else {
                    maxBalls++;
                }
                last = now;
                while (balls.length > 0 && balls.length > maxBalls) {
                    balls.shift();
                }
                for (var i = 0; i < balls.length; i++) {
                    var ball = balls[i];
                    ball.vy += 1 / 1000 * dist; //gravity wins
                    ball.vx = ball.vx - (1 / 1000 * ball.vx * dist); //friction wins

                    if (ball.y >= canvasHeight - ball.radius) {
                        ball.vy = -ball.vy * (1 - elasticityFloor);
                        ball.vy = (ball.vy * 10 | 0) / 10;
                    }
                    if ((ball.x >= canvasWidth - ball.radius && ball.vx > 0)
                        || (ball.x <= ball.radius && ball.vx < 0)) {
                        ball.vx = -ball.vx * (1 - elasticityWall);
                        ball.vx = (ball.vx * 10 | 0) / 10;
                    }
                    ball.y = Math.min(ball.y + dist * ball.vy, canvasHeight - ball.radius);
                    ball.x = ball.x + dist * ball.vx;
                }
            }

            var lastPointers = [];
            function handleMove(ev) {
                var x = ev.clientX
                    , y = ev.clientY;
                if (!lastPointers[ev.pointerId]) {
                    lastPointers[ev.pointerId] = {
                        x: 0,
                        y: 0
                    };
                }

                var lastPointer = lastPointers[ev.pointerId];
                if (Math.sqrt(Math.pow(lastPointer.x - x, 2) + Math.pow(lastPointer.y - y, 2)) > 10) {
                    lastPointer.x = x;
                    lastPointer.y = y;

                    var normalizeRGB = function normalizeRGB(RGB) {
                        var max = Math.max.apply(this, RGB);
                        if (max === RGB[0]) {
                            balls.redCount++;
                        } else if (max === RGB[1]) {
                            balls.greenCount++;
                        } else {
                            balls.blueCount++;
                        }
                        return RGB.map(function (value, index, array) {
                            return (Math.pow(2, value / max * 8) | 0) - 1;
                        });
                    }

                    var RGB = normalizeRGB([Math.random(), Math.random(), Math.random()])
                        , colorString = "rgb(" + RGB.join(",") + ")"
                        , radius = 20;

                    balls.push({
                        x: Math.min(Math.max(lastPointer.x, radius), canvasWidth - radius),
                        y: Math.min(Math.max(lastPointer.y, radius), canvasHeight - radius),
                        radius: radius,
                        color: colorString,
                        vx: Math.random() - .5,
                        vy: -2 * Math.random() + 1
                    });
                }
            }
            if (window.onpointermove) {
                window.addEventListener("pointermove", handleMove);
            } else {
                window.addEventListener("mousemove", handleMove);
            }
        })();
    </script>
</body>

</html>